<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FanevaJiro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/recharts@2.5.0/dist/Recharts.js"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        // COLLEZ ICI TOUT LE CODE REACT DE L'APPLICATION
        // (Le code que je vous ai fourni dans l'artifact)
      import React, { useState, useEffect } from 'react';
import { Plus, Users, BarChart3, Search, ArrowLeft, Edit2, Trash2, FileText } from 'lucide-react';
import { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } from 'recharts';

const FanevaJiro = () => {
  const [page, setPage] = useState('home');
  const [habitants, setHabitants] = useState([]);
  const [selectedHabitant, setSelectedHabitant] = useState(null);
  const [searchTerm, setSearchTerm] = useState('');
  const [newHabitant, setNewHabitant] = useState({ nom: '', adresse: '' });
  const [newFacture, setNewFacture] = useState({
    indexGeneral: '',
    prixIndexGeneral: '',
    nouveauIndex: '',
    ancienIndex: ''
  });
  const [editingFacture, setEditingFacture] = useState(null);

  // Charger les données au démarrage
  useEffect(() => {
    const saved = JSON.parse(localStorage.getItem('fanevajiro') || '[]');
    setHabitants(saved);
  }, []);

  // Sauvegarder les données
  const saveData = (data) => {
    localStorage.setItem('fanevajiro', JSON.stringify(data));
    setHabitants(data);
  };

  // Ajouter un habitant
  const ajouterHabitant = () => {
    if (!newHabitant.nom || !newHabitant.adresse) return;
    
    const nouvelHabitant = {
      id: Date.now(),
      nom: newHabitant.nom,
      adresse: newHabitant.adresse,
      factures: []
    };
    
    saveData([...habitants, nouvelHabitant]);
    setNewHabitant({ nom: '', adresse: '' });
    setPage('home');
  };

  // Calculer le prix
  const calculerPrix = (indexHabitant, prixIndexGeneral, indexGeneral) => {
    return (indexHabitant * prixIndexGeneral) / indexGeneral;
  };

  // Ajouter une facture
  const ajouterFacture = () => {
    const { indexGeneral, prixIndexGeneral, nouveauIndex, ancienIndex } = newFacture;
    
    if (!indexGeneral || !prixIndexGeneral || !nouveauIndex) return;
    
    const indexHabitant = parseFloat(nouveauIndex) - (parseFloat(ancienIndex) || 0);
    const prix = calculerPrix(indexHabitant, parseFloat(prixIndexGeneral), parseFloat(indexGeneral));
    
    const facture = {
      id: Date.now(),
      date: new Date().toLocaleDateString('fr-FR'),
      heure: new Date().toLocaleTimeString('fr-FR'),
      indexGeneral: parseFloat(indexGeneral),
      prixIndexGeneral: parseFloat(prixIndexGeneral),
      ancienIndex: parseFloat(ancienIndex) || 0,
      nouveauIndex: parseFloat(nouveauIndex),
      indexHabitant,
      prix: Math.round(prix)
    };
    
    const updated = habitants.map(h => 
      h.id === selectedHabitant.id 
        ? { ...h, factures: [...h.factures, facture] }
        : h
    );
    
    saveData(updated);
    setNewFacture({ indexGeneral: '', prixIndexGeneral: '', nouveauIndex: '', ancienIndex: '' });
    setSelectedHabitant(updated.find(h => h.id === selectedHabitant.id));
    setPage('habitant');
  };

  // Modifier une facture
  const modifierFacture = () => {
    const { indexGeneral, prixIndexGeneral, nouveauIndex, ancienIndex } = newFacture;
    
    const indexHabitant = parseFloat(nouveauIndex) - parseFloat(ancienIndex);
    const prix = calculerPrix(indexHabitant, parseFloat(prixIndexGeneral), parseFloat(indexGeneral));
    
    const factureModifiee = {
      ...editingFacture,
      indexGeneral: parseFloat(indexGeneral),
      prixIndexGeneral: parseFloat(prixIndexGeneral),
      ancienIndex: parseFloat(ancienIndex),
      nouveauIndex: parseFloat(nouveauIndex),
      indexHabitant,
      prix: Math.round(prix)
    };
    
    const updated = habitants.map(h => 
      h.id === selectedHabitant.id 
        ? { ...h, factures: h.factures.map(f => f.id === editingFacture.id ? factureModifiee : f) }
        : h
    );
    
    saveData(updated);
    setEditingFacture(null);
    setNewFacture({ indexGeneral: '', prixIndexGeneral: '', nouveauIndex: '', ancienIndex: '' });
    setSelectedHabitant(updated.find(h => h.id === selectedHabitant.id));
    setPage('habitant');
  };

  // Supprimer une facture
  const supprimerFacture = (factureId) => {
    if (!confirm('Supprimer cette facture ?')) return;
    
    const updated = habitants.map(h => 
      h.id === selectedHabitant.id 
        ? { ...h, factures: h.factures.filter(f => f.id !== factureId) }
        : h
    );
    
    saveData(updated);
    setSelectedHabitant(updated.find(h => h.id === selectedHabitant.id));
  };

  // Préparer données pour le graphique
  const getChartData = () => {
    const monthlyData = {};
    
    habitants.forEach(h => {
      h.factures.forEach(f => {
        const [day, month, year] = f.date.split('/');
        const key = `${month}/${year}`;
        
        if (!monthlyData[key]) {
          monthlyData[key] = 0;
        }
        monthlyData[key] += f.indexGeneral;
      });
    });
    
    return Object.entries(monthlyData)
      .map(([mois, total]) => ({ mois, total }))
      .slice(-6);
  };

  // Filtrer habitants
  const habitantsFiltres = habitants.filter(h => 
    h.nom.toLowerCase().includes(searchTerm.toLowerCase()) ||
    h.adresse.toLowerCase().includes(searchTerm.toLowerCase())
  );

  // Page d'accueil
  if (page === 'home') {
    return (
      <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100">
        <div className="bg-indigo-600 text-white p-6 shadow-lg">
          <h1 className="text-3xl font-bold text-center">FanevaJiro</h1>
        </div>
        
        <div className="p-6 space-y-6">
          <button
            onClick={() => setPage('ajout')}
            className="w-full bg-indigo-600 text-white p-4 rounded-xl shadow-lg flex items-center justify-center gap-3 hover:bg-indigo-700 transition"
          >
            <Plus size={24} />
            <span className="text-lg font-semibold">Ajouter un habitant</span>
          </button>
          
          <div className="bg-white rounded-xl shadow-lg p-6">
            <h2 className="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
              <BarChart3 className="text-indigo-600" />
              Historique index général
            </h2>
            {getChartData().length > 0 ? (
              <ResponsiveContainer width="100%" height={250}>
                <LineChart data={getChartData()}>
                  <CartesianGrid strokeDasharray="3 3" />
                  <XAxis dataKey="mois" />
                  <YAxis />
                  <Tooltip />
                  <Legend />
                  <Line type="monotone" dataKey="total" stroke="#4F46E5" strokeWidth={2} name="Index général" />
                </LineChart>
              </ResponsiveContainer>
            ) : (
              <p className="text-gray-500 text-center py-8">Aucune donnée disponible</p>
            )}
          </div>
          
          <button
            onClick={() => setPage('liste')}
            className="w-full bg-white text-indigo-600 p-4 rounded-xl shadow-lg flex items-center justify-center gap-3 hover:bg-gray-50 transition border-2 border-indigo-600"
          >
            <Users size={24} />
            <span className="text-lg font-semibold">Liste des habitants</span>
          </button>
        </div>
      </div>
    );
  }

  // Page ajout habitant
  if (page === 'ajout') {
    return (
      <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100">
        <div className="bg-indigo-600 text-white p-6 shadow-lg flex items-center gap-4">
          <button onClick={() => setPage('home')}>
            <ArrowLeft size={24} />
          </button>
          <h1 className="text-2xl font-bold">Nouvel habitant</h1>
        </div>
        
        <div className="p-6">
          <div className="bg-white rounded-xl shadow-lg p-6 space-y-4">
            <div>
              <label className="block text-sm font-semibold text-gray-700 mb-2">Nom</label>
              <input
                type="text"
                value={newHabitant.nom}
                onChange={(e) => setNewHabitant({ ...newHabitant, nom: e.target.value })}
                className="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none"
                placeholder="Nom de l'habitant"
              />
            </div>
            
            <div>
              <label className="block text-sm font-semibold text-gray-700 mb-2">Adresse</label>
              <input
                type="text"
                value={newHabitant.adresse}
                onChange={(e) => setNewHabitant({ ...newHabitant, adresse: e.target.value })}
                className="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none"
                placeholder="Adresse"
              />
            </div>
            
            <button
              onClick={ajouterHabitant}
              className="w-full bg-indigo-600 text-white p-4 rounded-lg font-semibold hover:bg-indigo-700 transition"
            >
              Enregistrer
            </button>
          </div>
        </div>
      </div>
    );
  }

  // Page liste habitants
  if (page === 'liste') {
    return (
      <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100">
        <div className="bg-indigo-600 text-white p-6 shadow-lg flex items-center gap-4">
          <button onClick={() => setPage('home')}>
            <ArrowLeft size={24} />
          </button>
          <h1 className="text-2xl font-bold">Liste des habitants</h1>
        </div>
        
        <div className="p-6 space-y-4">
          <div className="relative">
            <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400" size={20} />
            <input
              type="text"
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
              className="w-full pl-10 p-3 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none bg-white"
              placeholder="Rechercher..."
            />
          </div>
          
          <div className="space-y-3">
            {habitantsFiltres.map(h => (
              <div
                key={h.id}
                onClick={() => {
                  setSelectedHabitant(h);
                  setPage('habitant');
                }}
                className="bg-white p-4 rounded-xl shadow hover:shadow-lg transition cursor-pointer"
              >
                <h3 className="font-bold text-lg text-gray-800">{h.nom}</h3>
                <p className="text-gray-600 text-sm">{h.adresse}</p>
                <p className="text-indigo-600 text-sm mt-1">{h.factures.length} facture(s)</p>
              </div>
            ))}
            
            {habitantsFiltres.length === 0 && (
              <p className="text-center text-gray-500 py-8">Aucun habitant trouvé</p>
            )}
          </div>
        </div>
      </div>
    );
  }

  // Page habitant
  if (page === 'habitant' && selectedHabitant) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100">
        <div className="bg-indigo-600 text-white p-6 shadow-lg">
          <button onClick={() => setPage('liste')} className="mb-4">
            <ArrowLeft size={24} />
          </button>
          <h1 className="text-2xl font-bold">{selectedHabitant.nom}</h1>
          <p className="text-indigo-100">{selectedHabitant.adresse}</p>
        </div>
        
        <div className="p-6 space-y-4">
          <button
            onClick={() => {
              const dernierIndex = selectedHabitant.factures.length > 0 
                ? selectedHabitant.factures[selectedHabitant.factures.length - 1].nouveauIndex 
                : 0;
              setNewFacture({ ...newFacture, ancienIndex: dernierIndex.toString() });
              setPage('facture');
            }}
            className="w-full bg-indigo-600 text-white p-4 rounded-xl shadow-lg flex items-center justify-center gap-3 hover:bg-indigo-700 transition"
          >
            <FileText size={24} />
            <span className="text-lg font-semibold">Nouvelle facture</span>
          </button>
          
          <div className="bg-white rounded-xl shadow-lg p-6">
            <h2 className="text-xl font-bold text-gray-800 mb-4">Historique des factures</h2>
            
            <div className="space-y-3">
              {selectedHabitant.factures.slice().reverse().map(f => (
                <div key={f.id} className="border-2 border-gray-200 rounded-lg p-4">
                  <div className="flex justify-between items-start mb-2">
                    <div>
                      <p className="text-sm text-gray-600">{f.date} à {f.heure}</p>
                      <p className="text-2xl font-bold text-indigo-600 mt-1">{f.prix.toLocaleString()} Ar</p>
                    </div>
                    <div className="flex gap-2">
                      <button
                        onClick={() => {
                          setEditingFacture(f);
                          setNewFacture({
                            indexGeneral: f.indexGeneral.toString(),
                            prixIndexGeneral: f.prixIndexGeneral.toString(),
                            nouveauIndex: f.nouveauIndex.toString(),
                            ancienIndex: f.ancienIndex.toString()
                          });
                          setPage('facture');
                        }}
                        className="p-2 text-blue-600 hover:bg-blue-50 rounded-lg"
                      >
                        <Edit2 size={18} />
                      </button>
                      <button
                        onClick={() => supprimerFacture(f.id)}
                        className="p-2 text-red-600 hover:bg-red-50 rounded-lg"
                      >
                        <Trash2 size={18} />
                      </button>
                    </div>
                  </div>
                  
                  <div className="grid grid-cols-2 gap-2 text-sm mt-3 pt-3 border-t border-gray-200">
                    <div>
                      <p className="text-gray-600">Index général</p>
                      <p className="font-semibold">{f.indexGeneral}</p>
                    </div>
                    <div>
                      <p className="text-gray-600">Prix/index</p>
                      <p className="font-semibold">{f.prixIndexGeneral.toLocaleString()} Ar</p>
                    </div>
                    <div>
                      <p className="text-gray-600">Index habitant</p>
                      <p className="font-semibold">{f.indexHabitant}</p>
                    </div>
                    <div>
                      <p className="text-gray-600">Index</p>
                      <p className="font-semibold">{f.ancienIndex} → {f.nouveauIndex}</p>
                    </div>
                  </div>
                </div>
              ))}
              
              {selectedHabitant.factures.length === 0 && (
                <p className="text-center text-gray-500 py-8">Aucune facture enregistrée</p>
              )}
            </div>
          </div>
        </div>
      </div>
    );
  }

  // Page nouvelle facture
  if (page === 'facture') {
    return (
      <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100">
        <div className="bg-indigo-600 text-white p-6 shadow-lg flex items-center gap-4">
          <button onClick={() => {
            setPage('habitant');
            setEditingFacture(null);
            setNewFacture({ indexGeneral: '', prixIndexGeneral: '', nouveauIndex: '', ancienIndex: '' });
          }}>
            <ArrowLeft size={24} />
          </button>
          <h1 className="text-2xl font-bold">{editingFacture ? 'Modifier' : 'Nouvelle'} facture</h1>
        </div>
        
        <div className="p-6">
          <div className="bg-white rounded-xl shadow-lg p-6 space-y-4">
            <div>
              <label className="block text-sm font-semibold text-gray-700 mb-2">Index général</label>
              <input
                type="number"
                value={newFacture.indexGeneral}
                onChange={(e) => setNewFacture({ ...newFacture, indexGeneral: e.target.value })}
                className="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none"
                placeholder="Ex: 1000"
              />
            </div>
            
            <div>
              <label className="block text-sm font-semibold text-gray-700 mb-2">Prix de l'index général (Ar)</label>
              <input
                type="number"
                value={newFacture.prixIndexGeneral}
                onChange={(e) => setNewFacture({ ...newFacture, prixIndexGeneral: e.target.value })}
                className="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none"
                placeholder="Ex: 50000"
              />
            </div>
            
            <div>
              <label className="block text-sm font-semibold text-gray-700 mb-2">Ancien index</label>
              <input
                type="number"
                value={newFacture.ancienIndex}
                onChange={(e) => setNewFacture({ ...newFacture, ancienIndex: e.target.value })}
                className="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none"
                placeholder="Ex: 0"
              />
            </div>
            
            <div>
              <label className="block text-sm font-semibold text-gray-700 mb-2">Nouveau index</label>
              <input
                type="number"
                value={newFacture.nouveauIndex}
                onChange={(e) => setNewFacture({ ...newFacture, nouveauIndex: e.target.value })}
                className="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none"
                placeholder="Ex: 50"
              />
            </div>
            
            {newFacture.indexGeneral && newFacture.prixIndexGeneral && newFacture.nouveauIndex && (
              <div className="bg-indigo-50 p-4 rounded-lg border-2 border-indigo-200">
                <p className="text-sm text-gray-700 mb-1">Prix calculé :</p>
                <p className="text-3xl font-bold text-indigo-600">
                  {Math.round(calculerPrix(
                    parseFloat(newFacture.nouveauIndex) - (parseFloat(newFacture.ancienIndex) || 0),
                    parseFloat(newFacture.prixIndexGeneral),
                    parseFloat(newFacture.indexGeneral)
                  )).toLocaleString()} Ar
                </p>
                <p className="text-xs text-gray-600 mt-2">
                  Index habitant: {parseFloat(newFacture.nouveauIndex) - (parseFloat(newFacture.ancienIndex) || 0)}
                </p>
              </div>
            )}
            
            <button
              onClick={editingFacture ? modifierFacture : ajouterFacture}
              className="w-full bg-indigo-600 text-white p-4 rounded-lg font-semibold hover:bg-indigo-700 transition"
            >
              {editingFacture ? 'Modifier' : 'Enregistrer'}
            </button>
          </div>
        </div>
      </div>
    );
  }

  return null;
};

export default FanevaJiro;
    </script>
</body>
</html>
